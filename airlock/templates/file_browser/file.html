{% fragment as buttons %}
  <div class="flex items-center gap-2">
    {% if context == "workspace" %}
      {% if form %}
        {% #modal id="addRequestFile" button_text="Add File to Request" variant="success" %}
          {% #card container=True title="Add a file" %}
            <form action="{{ request_file_url }}" method="POST" aria-label="add-file-form">
              {% csrf_token %}
              {% form_radios class="w-full max-w-lg mx-auto" label="Type of file" field=form.filetype selected=form.filetype.value %}
              {% form_select class="w-full max-w-lg mx-auto" label="Select a file group" field=form.filegroup choices=form.filegroup.field.choices %}
              {% form_input class="w-full max-w-lg mx-auto" label="Or create a new file group" field=form.new_filegroup %}
              <input type=hidden name="path" value="{{ path_item.relpath }}"/>
              <div class="mt-2">
                {% #button type="submit" variant="success" id="add-file-button" %}Add File to Request{% /button %}
                {% #button variant="danger" type="cancel" %}Cancel{% /button %}
              </div>
            </form>
          {% /card %}
        {% /modal %}
      {% elif file_in_request %}
        {% #button type="button" disabled=True tooltip="This file has already been added to the current request" id="add-file-modal-button-disabled" %}
          Add File to Request
        {% /button %}
      {% elif not path_item.is_valid %}
        {% #button type="button" disabled=True tooltip="This file type cannot be added to a request" id="add-file-modal-button-disabled" %}
          Add File to Request
        {% /button %}
      {% else %}
        {% #button type="button" disabled=True tooltip="You do not have permission to add this file to a request" id="add-file-modal-button-disabled" %}
          Add File to Request
        {% /button %}
      {% endif %}
    {% else %}{# request #}
      {% if path_item.is_supporting  %}
        {% #description_item title="Supporting file" %}This is a supporting file and will not be released.{% /description_item%}
      {% elif path_item.is_withdrawn %}
        {% #description_item title="Withdrawn file" %}This file has been withdrawn and will not be released.{% /description_item%}
      {% endif %}

      {% if is_author %}
        {% if path_item.is_output and file_withdraw_url %}
          <form action="{{ file_withdraw_url }}" method="POST">
            {% csrf_token %}
            <input type=hidden name="path" value="{{ path_item.relpath }}"/>
            {% #button type="submit" id="withdraw-file-button" tooltip="Withdraw this file from this request" variant="warning" %}Withdraw from Request{% /button %}
          </form>
        {% endif %}
      {% elif is_output_checker %}
        {% if file_approve_url %}
          <form action="{{ file_approve_url }}" method="POST">
            {% csrf_token %}
            {% #button type="submit" variant="success" id="file-approve-button" %}Approve File{% /button %}
          </form>
        {% else %}
          {% csrf_token %}
          {% #button type="submit" variant="success" disabled=True id="file-approve-button" %}Approve File{% /button %}
        {% endif %}
        {% if file_reject_url %}
          <form action="{{ file_reject_url }}" method="POST">
            {% csrf_token %}
            {% #button type="submit" variant="danger" href=file_reject_url id="file-reject-button" %}Reject File{% /button %}
          </form>
        {% else %}
          {% csrf_token %}
          {% #button type="submit" variant="danger" disabled=True href=file_reject_url id="file-reject-button" %}Reject File{% /button %}
        {% endif %}
        {% #button variant="primary" type="link" href=path_item.download_url id="download-button" %}Download file{% /button %}
      {% endif %}
    {% endif %}
    {% #button variant="primary" type="link" href=path_item.contents_url external=True id="view-button" %}View â†—{% /button %}
  </div>

{% endfragment %}

{% #card title=path_item.name container=True custom_button=buttons %}
  <div class="content">
    <iframe src="{{ path_item.contents_url }}"
            title="{{ path_item.relpath }}"
            frameborder=0
            height=1000
            style="width: 100%;"
            sandbox="{{ path_item.iframe_sandbox }} allow-same-origin"
    ></iframe>
  </div>
{% /card %}
