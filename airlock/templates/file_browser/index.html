{% extends "base.html" %}

{% block full_width_content %}

{% fragment as action_button %}
  {% if is_author %}
    <form action="" method="POST">
    {% csrf_token %}
    <input type=hidden name="workspace" value="{{ workspace.name }}"/>
    <input type=hidden name="release_request" value="{{ release_request.request_id }}"/>
    {% #button type="submit" tooltip="This output request is ready to be reviewed" variant="success" %}Submit Output Request For Review{% /button %}
    </form>
  {% elif is_output_checker %}
  <form action="{{ release_files_url }}" method="POST">
    {% csrf_token %}
    {% #button type="submit" tooltip="Release these to jobs.opensafely.org" variant="danger" %}Release Files{% /button %}
    </form>
  {% endif %}
  {% if context == "request" %}
  {% #button type="link" href=workspace.url variant="success" %}Workspace Home{% /button %}
  {% endif %}
{% endfragment %}

{% #card title=title custom_button=action_button %}  
{% #breadcrumbs %}
    {% breadcrumb title=path_item.container.get_id url=path_item.container.get_absolute_url %}
    {% for crumb in path_item.breadcrumbs %}
        {% breadcrumb title=crumb.name url=crumb.url active=forloop.last %}
    {% endfor %}
{% /breadcrumbs %}

{% /card %}

<div class="flex flex-row">

  <div style="flex-basis: 25%">

    {% #card %}
      {% #list_group %}
        {% if not path_item.parent %}
          {% list_group_empty icon=True title=context|title|add:" Root" %}   
        {% else %}
          {% #list_group_item href=path_item.parent.url %}
            â†° ..
          {% /list_group_item %}
          {% for entry in path_item.siblings %}
            {% #list_group_item href=entry.url %}
              {{ entry.name}}
              {% if entry.is_directory %}
                {% icon_folder_outline class="h-6 w-6 text-slate-600 inline" %}
              {% endif %}
            {% /list_group_item %}
          {% endfor %}
        {% endif %}
      {% /list_group %}
    {% /card %}

  </div>

  <div style="flex-basis: 75%; max-width: 75%">
    {% if path_item.is_directory %}

      {% #card title=path_item.name %}
        {% #list_group %}
          {% if not path_item.children %}
            {% list_group_empty icon=True title="Empty Directory" %}
          {% else %}
            {% for entry in path_item.children %}
              {% #list_group_item href=entry.url %}
                {{ entry.name}}
                {% if entry.is_directory %}
                  {% icon_folder_outline class="h-6 w-6 text-slate-600 inline" %}
                {% endif %}
              {% /list_group_item %}
            {% endfor %}
          {% endif %}
        {% /list_group %}
      {% /card %}

    {% else %}

      {% fragment as add_button %}
        {% if context == "workspace" %}
          <form action="{{ add_file_url }}" method="POST">
            {% csrf_token %}
            <input type=hidden name="path" value="{{ path_item.relpath }}"/>
            {% #button type="submit" tooltip="Add this file to the current output request, starting a new one if needed" variant="success" %}Add File to Output Request{% /button %}
          </form>
        {% elif is_author %}
          <form action="" method="POST">
            {% csrf_token %}
            <input type=hidden name="file" value="{{ path_item.relpath }}"/>
            <input type=hidden name="workspace" value="{{ workspace.name }}"/>
            <input type=hidden name="release_request" value="{{ release_request.request_id }}"/>
            {% #button type="submit" tooltip="Remove this file from this output request" variant="warning" %}Remove File from Output Request{% /button %}
          </form>
 
        {% endif %}
      {% endfragment %}

      {% #card title=path_item.name custom_button=add_button %}

        {% if path_item.suffix == '.html' %}
          <iframe
            srcdoc="{{ path_item.contents }}"
            title="{{ path_item.relpath }}"
            frameborder=0
            height=1000
            style="width: 100%;"
          >
          </iframe>
        {% else %}
          {% #code %}
          {{ path_item.contents }}
          {% /code %}
        {% endif %}
      {% /card %}

    {% endif %}

  </div>

</div>

{% endblock full_width_content %}
