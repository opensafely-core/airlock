{# hide default button, as we are going to autoshow the modal anyway #}
{% fragment as button %}
{% endfragment %}
{% #modal id="addRequestFile" modal_class="m-8 !w-[calc(100%-4rem)] !max-w-none !h-[calc(100vh-4rem)] !max-h-none" custom_button=button  autoshow=True %}
  <h2 id="add-files-to-request-title" class="text-xl font-semibold tracking-tight text-slate-900 border-b border-b-slate-300 px-4 py-2">
    Add Files to Request
  </h2>

  <form
    action="{{ add_file_url }}"
    aria-label="add-file-form"
    class="flex flex-col h-[calc(100%-4rem)] items-stretch justify-start"
    method="POST"
  >
    {% csrf_token %}
    {{ form.next_url }}
    {{ formset.management_form }}

    <h3 class="text-lg font-semibold px-4 pt-4 pb-1">
      Set file state
    </h3>

    <div class="divide-y divide-slate-200 border-y border-y-slate-200">
      {% for formset_form in formset %}
        <fieldset class="flex flex-row w-full gap-x-8 py-1 px-4 odd:bg-white even:bg-slate-50">
          <legend class="float-left">
            <span>{{ formset_form.file.value }}</span>
            {{ formset_form.file }}
          </legend>
          <div class="flex-shrink-0 ml-auto text-sm flex flex-row gap-x-3">
            {% for value, label in formset_form.filetype.field.choices %}
              {% with id=forloop.counter|stringformat:"s" %}
                <label class="leading-none flex flex-row gap-x-1 items-center" for="{{ formset_form.filetype.auto_id }}_{{ id }}">
                  <input type="radio" id="{{ formset_form.filetype.auto_id }}_{{ id }}" name="{{ formset_form.filetype.html_name }}" value="{{ value }}" />
                  {{ label }}
                </label>
              {% endwith %}
            {% endfor %}
          </div>
        </fieldset>
      {% endfor %}
    </div>

    <!-- {% if not no_valid_files %}
      <div>
        {% form_select class="w-full max-w-lg mx-auto" label="Select a file group" field=form.filegroup choices=form.filegroup.field.choices %}
        {% form_input class="w-full max-w-lg mx-auto" label="Or create a new file group" field=form.new_filegroup %}
      </div>
    {% endif %} -->

    <div class="flex-shrink-0 mt-auto border-t border-t-slate-300 p-4 pb-0">
      {% #button type="submit" variant="success" id="add-file-button" disabled=no_valid_files %}Add Files to Request{% /button %}
      {% #button variant="danger" type="cancel" %}Cancel{% /button %}
    </div>
  </form>
{% /modal %}
